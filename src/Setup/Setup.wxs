<!--
	Installer for SharpDevelop.
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<!--
		Windows Installer only recognises 3 digits for the product version (Major.Minor.Build) 
		so the third digit must be the revision number. 
	-->

	<!-- PRODUCTMAJORVERSION is major.minor (e.g. 4.1), retrieved from GlobalAssemblyInfo.template -->
	<!-- PRODUCTBUILDVERSION is the revision number (e.g. 6963), calculated from git -->
	<!-- PRODUCTDISPLAYVERSION is a string like "4.1 Beta 1" (version name retrieved from GlobalAssemblyInfo.template) -->
	
	<Product Id="*" 
		Name="SharpDevelop $(var.PRODUCTDISPLAYVERSION)"
		Manufacturer="ic#code"
		Language="1033"
		Codepage="1252"
		UpgradeCode="EAB97D14-7713-4001-98E0-0414F495ECB8"
		Version="$(var.PRODUCTMAJORVERSION).$(var.PRODUCTBUILDVERSION)">
		
		<!-- When a new major SharpDevelop version should be allowed to be installed in parallel to old versions,
			 we need a new upgrade code (2 occurrences!), and the "Minimum Version" for upgrades needs to be adjusted.
		-->

		<Package Description="SharpDevelop $(var.PRODUCTDISPLAYVERSION)"
			InstallerVersion="300"
			Compressed="yes"/>
		
		<!-- Upgrade information -->
		<Upgrade Id="EAB97D14-7713-4001-98E0-0414F495ECB8">
			<!-- The UpgradeCode must be changed to allow two versions of SharpDevelop to be installed side-by-side -->
			
			<!-- Checks for older versions -->
			<UpgradeVersion Minimum="4.3.0"
				IncludeMinimum="yes"
				Maximum="$(var.PRODUCTMAJORVERSION).$(var.PRODUCTBUILDVERSION)"
				IncludeMaximum="no" 
				Property="PREVIOUSVERSIONFOUND"/>
			<!-- Checks for newer versions -->
			<UpgradeVersion OnlyDetect="yes"
				Property="NEWERVERSIONFOUND"
				Minimum="$(var.PRODUCTMAJORVERSION).$(var.PRODUCTBUILDVERSION)"
				IncludeMinimum="no"/>
		</Upgrade>
		
		<!--
			Conditions to be satisfied before the installer begins.
			Note that we are using "Installed OR" in the conditions so
			so they never block the user from repairing, patching, or 
			uninstalling the package after it has been installed. 

			For example the user could do something odd like uninstall .NET 
 			and then run the msi to uninstall SharpDevelop. Without the 
			"Installed OR" this would not be allowed.
		-->
		<!--
			Check for .NET 4.0 RTM Full
		-->
		<Property Id="NETFRAMEWORK40FULL" Secure="yes">
			<RegistrySearch Id="NetFramework40Full" Root="HKLM" Key="SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Full" Name="Install" Type="raw" />
		</Property>
		<Property Id="NETFRAMEWORK40FULLVERSION" Secure="yes">
			<RegistrySearch Id="NetFramework40FullVersion" Root="HKLM" Key="Software\Microsoft\NET Framework Setup\NDP\v4\Full" Name="Version" Type="raw" />
		</Property>
		<!-- we could check NETFRAMEWORK40FULLVERSION optionally if we want to force the user to install a specific version -->
		<Condition Message="This setup requires the .NET 4.0 Full Framework to be installed.">
			Installed OR NETFRAMEWORK40FULL
		</Condition>
		
		<!--
			Check for C++ 2008 Runtime (we accept any 2008 runtime version).
			We only need the VC9 CRT, but unfortunately I couldn't find any way to detect if that is installed.
			So instead, we conservatively check that the whole C++ runtime is installed.
			However, we know that .NET 3.5 installs the C++ runtime parts we need (.NET 4.0 doesn't), so we'll check for
			VCPP2008RUNTIME OR NETFRAMEWORK35.
 		-->
		<Property Id="VCPP2008RUNTIME" Secure="yes">
			<RegistrySearch Id="VCpp2008Runtime" Root="HKLM" Key="SOFTWARE\Microsoft\DevDiv\VC\Servicing\9.0" Name="SP" Type="raw" />
		</Property>
		<PropertyRef Id="NETFRAMEWORK35"/>
		<Condition Message="This setup requires the Microsoft Visual C++ 2008 SP1 Redistributable Package to be installed.">
			Installed OR (VCPP2008RUNTIME &lt;&gt; "") OR NETFRAMEWORK35
		</Condition>
		
		<!--
			Check the user has elevated permissions. We need admin rights to NGen 
			SharpDevelop.exe and to register the Help collection. 

			The old Setup.exe displays a RunAs dialog only because when it is named 
			"Setup.exe". So do we display an error message or let the installation
			fail? The failure message is obscure so a message is before launching
			is probably better.
		-->
		<!-- Not used since the install will work without admin rights.
		<Condition Message="Administrator rights are required to install SharpDevelop.">
			Privileged
		</Condition> -->
		
		<!--
			Install for all users.

			Using ALLUSERS=2 means SharpDevelop can be installed by a non-admin. 
			In this case it will be a per-user installation installed into the 
			user's personal profile. 

			(The installer will be adding assemblies to the GAC and using NGen 
			on SharpDevelop.exe if and only if the user has admin rights)

			http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/allusers.asp
		-->
		<Property Id="ALLUSERS">2</Property>
		
		<!--
			Support entries shown when clicking "Click here for support information"
			in Control Panel's Add/Remove Programs

			http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/configuration_properties.asp
		-->
		<Property Id="ARPCONTACT">http://icsharpcode.net/OpenSource/SD/ContactUs.asp</Property>
		<Property Id="ARPHELPLINK">http://community.sharpdevelop.net/forums/</Property>
		<Property Id="ARPURLINFOABOUT">http://icsharpcode.net/OpenSource/SD/</Property>
		<Property Id="ARPURLUPDATEINFO">http://icsharpcode.net/OpenSource/SD/Download/</Property>
		
		<!-- Suppress the Modify button in the Control Panel's Add/Remove Programs -->
		<!--
			Temporarily disabled whilst using the WixUI library 
			<Property Id="ARPNOMODIFY">1</Property> 
		-->
		
		<!-- Puts SharpDevelop icon in Control Panel's Add/Remove Programs -->
		<Property Id="ARPPRODUCTICON">SharpDevelopIcon.exe</Property>
		<Icon Id="SharpDevelopIcon.exe" SourceFile="..\Main\Start_Up\Project\Resources\SharpDevelop.ico"/>
		
		<!--
			Source media for the installation. 
 			Specifies a single cab file to be embedded in the installer's .msi. 
		-->
		<Media Id="1" Cabinet="contents.cab" EmbedCab="yes" CompressionLevel="high"/>
		
		<!-- Installation directory and files are defined in Files.wxs -->
		<Directory Id="TARGETDIR" Name="SourceDir"/>
		
		<!--
			Currently just one core feature to install everything. 
			Source code will become a separate feature. Perhaps all the add-ins too could
			each be a feature if the user wants to heavily customise the installation.
		-->
		<Feature Id="Complete"
		         Title="SharpDevelop $(var.PRODUCTMAJORVERSION)"
		         Description="Installs SharpDevelop and registers file associations"
		         Level="1"
		         ConfigurableDirectory="INSTALLDIR"
		         Absent="disallow"
		         AllowAdvertise="no"
		         InstallDefault="local"
		         Display="expand">
				<!-- 
					We put a reference to a dummy component which contains no files
					so we can get rid of the Network install options from the drop
					down menu for this feature. Seems to be a bug in Windows Installer.
				-->
				<ComponentRef Id="DummyCompleteFeatureComponent"/>
			<!--
				The SharpDevelop application. This may at some point in the distant
				future be further subdivided into addin features, but doing this
				will mean a new ProductCode will need to be generated.
			-->
			<Feature Id="SharpDevelop"
			         Title="SharpDevelop"
			         Description="Installs SharpDevelop"
			         Level="1"
			         InstallDefault="local"
			         AllowAdvertise="no"
			         Absent="disallow">
				<ComponentRef Id="SharpDevelopExe"/>
				<ComponentRef Id="SharpDevelopExeFiles"/>
				<ComponentRef Id="SharpDevelopDocFiles"/>
				<ComponentRef Id="ICSharpCodeBuildTasksDll"/>
				<ComponentRef Id="BuildTasksTargetFiles"/>
				<ComponentRef Id="ICSharpCodeCoreDll"/>
				<ComponentRef Id="ICSharpCodeCoreWinFormsDll"/>
				<ComponentRef Id="ICSharpCodeNRefactoryDll"/>
				<ComponentRef Id="ICSharpCodeSharpDevelopDll"/>
				<ComponentRef Id="ICSharpCodeSharpDevelopDomDll"/>
				<ComponentRef Id="ICSharpCodeSharpDevelopWidgets"/>
				<ComponentRef Id="ICSharpCodeSharpDevelopSdaFiles"/>
				<ComponentRef Id="ICSharpCodeAvalonEditDll"/>
				<ComponentRef Id="ICSharpCodeTreeViewDll"/>
				<ComponentRef Id="ICSharpCodeSharpDevelopBuildWorker35Exe"/>
				<ComponentRef Id="ICSharpCodeSharpDevelopBuildWorker40Exe"/>
				<ComponentRef Id="log4netDll"/>
				<ComponentRef Id="GraphSharpDll"/>
				<ComponentRef Id="GraphSharpControlsDll"/>
				<ComponentRef Id="QuickGraphDll"/>
				<ComponentRef Id="GraphSharpContractsDll"/>
				<ComponentRef Id="MicrosoftContractsDll"/>
				<ComponentRef Id="WPFExtensionsDll"/>
				<ComponentRef Id="MonoCecilDll"/>
				<ComponentRef Id="AvalonDockDll"/>
				<ComponentRef Id="ICSharpCodeCorePresentationDll"/>
				<ComponentRef Id="SharpDevelopTechNoteFiles"/>
				<ComponentRef Id="SharpDevelopProgramMenuItems"/>
				<ComponentRef Id="DesktopFolderItems"/>
				
				<ComponentRef Id="DariceCub"/>
				<ComponentRef Id="HeatExe"/>
				<ComponentRef Id="InsigniaExe"/>
				<ComponentRef Id="InsigniaExeConfig"/>
				<ComponentRef Id="NitExe"/>
				<ComponentRef Id="NitExeConfig"/>
				<ComponentRef Id="LuxExe"/>
				<ComponentRef Id="LuxExeConfig"/>
				<ComponentRef Id="LuxTargets"/>
				<ComponentRef Id="LuxTasksDll"/>
				<ComponentRef Id="MeltExe"/>
				<ComponentRef Id="MergeModCub"/>
				<ComponentRef Id="MSPatchCDll"/>
				<ComponentRef Id="PyroExe"/>
				<ComponentRef Id="SmokeExe"/>
				<ComponentRef Id="TorchExe"/>
				<ComponentRef Id="WConsoleDll"/>
				<ComponentRef Id="WuiDll"/>
				<ComponentRef Id="WixDifxAppExtensionDll"/>
				<ComponentRef Id="WixIIsExtensionDll"/>
				<ComponentRef Id="WixLuxExtensionDll"/>
				<ComponentRef Id="WixPSExtensionDll"/>
				<ComponentRef Id="WixSqlExtensionDll"/>
				<ComponentRef Id="WixUIExtensionDll"/>
				<ComponentRef Id="WixUtilExtensionDll"/>
				<ComponentRef Id="WixComPlusExtensionDll"/>
				<ComponentRef Id="WixMsmqExtensionDll"/>
				<ComponentRef Id="WixDirectXExtensionDll"/>
				<ComponentRef Id="WixFirewallExtensionDll"/>
				<ComponentRef Id="WixGamingExtensionDll"/>
				<ComponentRef Id="WixDIfxAppSchema"/>
				<ComponentRef Id="WixIisSchema"/>
				<ComponentRef Id="WixMSMQSchema"/>
				<ComponentRef Id="WixNetFxSchema"/>
				<ComponentRef Id="WixPSSchema"/>
				<ComponentRef Id="WixSqlSchema"/>
				<ComponentRef Id="WixUtilSchema"/>
				<ComponentRef Id="WixVSSchema"/>
				<ComponentRef Id="WixFirewallSchema"/>
				<ComponentRef Id="WixGamingSchema"/>
				<ComponentRef Id="WixLicenseFiles"/>
				<ComponentRef Id="WixBitmapFiles"/>
				<ComponentRef Id="WixVSExtension"/>
				<ComponentRef Id="Difxapp_ia64Wixlib"/>
				<ComponentRef Id="Difxapp_x64Wixlib"/>
				<ComponentRef Id="Difxapp_x86Wixlib"/>
				<ComponentRef Id="EmptyWixFileTemplate"/>
				<ComponentRef Id="WixDefaultLicenseRtf"/>
				<ComponentRef Id="EmptyWixProjectTemplate"/>
				<ComponentRef Id="EmptyWixDialogTemplate"/>
				<ComponentRef Id="WixDialogTemplate"/>

				<ComponentRef Id="CandleExe"/>
				<ComponentRef Id="DarkExe"/>
				<ComponentRef Id="LightExe"/>
				<ComponentRef Id="LitExe"/>
				<ComponentRef Id="MergeModDll"/>
				<ComponentRef Id="MicrosoftDeploymentWindowsInstallerDll"/>
				<ComponentRef Id="MicrosoftToolsWindowsInstallerXmlNAntTasksDll"/>
				<ComponentRef Id="WInteropDll"/>
				<ComponentRef Id="WixDll"/>
				<ComponentRef Id="Wix200xTargets"/>
				<ComponentRef Id="Wix2010Targets"/>
				<ComponentRef Id="WixCopExe"/>
				<ComponentRef Id="WixNetFxExtensionDll"/>
				<ComponentRef Id="WixTasksDll"/>

				<ComponentRef Id="NUnitUtilDll"/>
				<ComponentRef Id="NUnitConsoleFiles"/>
				<ComponentRef Id="NUnitConsoleX86Files"/>
				<ComponentRef Id="NUnitConsoleDotnet2Files"/>
				<ComponentRef Id="NUnitConsoleDotnet2X86Files"/>
			 	<ComponentRef Id="NUnitCoreDll"/>
				<ComponentRef Id="NUnitFrameworkDll"/>
				<ComponentRef Id="NUnitConsoleRunnerDll"/>
				<ComponentRef Id="NUnitCoreInterfacesDll"/>
				<ComponentRef Id="ConversionStyleSheetFiles"/>
				<ComponentRef Id="TextLibOptionsFiles"/>
				<ComponentRef Id="OptionsFiles"/>
				<ComponentRef Id="InstallerBitmapFiles"/>
				<ComponentRef Id="LanguageBitmapFiles"/>
				<ComponentRef Id="LayoutFiles"/>
				<ComponentRef Id="StringResourceFiles"/>
				<ComponentRef Id="SchemaFiles"/>
				<ComponentRef Id="CSharpFileTemplates"/>
				<ComponentRef Id="CSharpRecentFilesCollectionTemplate"/>				
				<ComponentRef Id="CSharpRecentFilesCollectionTemplateRecentFileElementClass"/>				
				<ComponentRef Id="CSharpRecentFilesCollectionTemplateRecentFilesCollectionClass"/>
				<ComponentRef Id="EmptyCSharpMvcWebProjectTemplate"/>
				<ComponentRef Id="CSharpMvcWebProjectTemplate"/>
				<ComponentRef Id="VBFileTemplates"/>
				<ComponentRef Id="EmptyVBMvcWebProjectTemplate"/>
				<ComponentRef Id="VBMvcWebProjectTemplate"/>
				<ComponentRef Id="CSharpMvcControllerFileTemplate"/>
				<ComponentRef Id="CSharpMvcViewPageFileTemplate"/>
				<ComponentRef Id="CSharpMvcViewContentPageFileTemplate"/>
				<ComponentRef Id="CSharpMvcViewMasterPageFileTemplate"/>
				<ComponentRef Id="CSharpMvcViewUserControlFileTemplate"/>
				<ComponentRef Id="VBMvcControllerFileTemplate"/>
				<ComponentRef Id="VBMvcViewPageFileTemplate"/>
				<ComponentRef Id="VBMvcViewContentPageFileTemplate"/>
				<ComponentRef Id="VBMvcViewMasterPageFileTemplate"/>
				<ComponentRef Id="VBMvcViewUserControlFileTemplate"/>
				
				<ComponentRef Id="CSharpWcfServiceProjectTemplate"/>
				<ComponentRef Id="CSharpWcfServiceFileTemplate"/>
				<ComponentRef Id="VBWcfServiceProjectTemplate"/>
				<ComponentRef Id="VBWcfServiceFileTemplate"/>
				
				<ComponentRef Id="CSharpWcfRestServiceProjectTemplate"/>
				<ComponentRef Id="CSharpWcfRestServiceFileTemplate"/>
				<ComponentRef Id="VBWcfRestServiceProjectTemplate"/>
				<ComponentRef Id="VBWcfRestServiceFileTemplate"/>
				
				<ComponentRef Id="EmptyHTMLFileTemplate"/>
				<ComponentRef Id="EmptyStyleSheetFileTemplate"/>
				<ComponentRef Id="EmptyJavaScriptFileTemplate"/>
				<ComponentRef Id="EmptyMsBuildFileTemplate"/>
				<ComponentRef Id="EmptyResourceFileTemplate"/>
				<ComponentRef Id="EmptyTextFileTemplate"/>
				<ComponentRef Id="EmptyXMLFileTemplate"/>
				<ComponentRef Id="SharpDevelopFileTemplates"/>
				<ComponentRef Id="CSharpProjectTemplates"/>
				<ComponentRef Id="CSharpWebServiceProjectTemplate"/>
				<ComponentRef Id="CSharpNotifyIconProjectTemplate"/>
				<ComponentRef Id="CSharpStructTemplate"/>
				<ComponentRef Id="CSharpConfigurationFileTemplates"/>
				<ComponentRef Id="MiscProjectTemplates"/>
				<ComponentRef Id="VBProjectTemplates"/>
				<ComponentRef Id="ExampleProjectTemplate"/>
				<ComponentRef Id="ICSharpCode.SharpDevelop.addin"/>
				<ComponentRef Id="BooBindingAddin"/>
				<ComponentRef Id="BooBindingDll"/>
				<ComponentRef Id="BoocExe"/>
				<ComponentRef Id="BoocExeConfig"/>
				<ComponentRef Id="BoocRsp"/>
				<ComponentRef Id="BooEmptyClassTemplate"/>
				<ComponentRef Id="BooEmptyFileTemplate"/>
				<ComponentRef Id="BooFormsProjectTemplate"/>
				<ComponentRef Id="BooFormTemplate"/>
				<ComponentRef Id="BooLangCodeDomDll"/>
				<ComponentRef Id="BooLangCompilerDll"/>
				<ComponentRef Id="BooLangDll"/>
				<ComponentRef Id="BooLangExtensionsDll"/>
				<ComponentRef Id="BooLangPatternMatchingDll"/>
				<ComponentRef Id="BooLangInterpreterDll"/>
				<ComponentRef Id="BooLangParserDll"/>
				<ComponentRef Id="BooLangUsefulDll"/>
				<ComponentRef Id="BooLibraryProjectTemplate"/>
				<ComponentRef Id="BooMicrosoftBuildTargets"/>
				<ComponentRef Id="BooMicrosoftBuildTasksDll"/>
				<ComponentRef Id="NRefactoryToBooConverterDll"/>
				<ComponentRef Id="BooConsoleProjectTemplate"/>
				<ComponentRef Id="DefaultAssemblyInfoBooTemplate"/>
				<ComponentRef Id="CSharpBindingFiles"/>
				<ComponentRef Id="VBNetBindingFiles"/>
				<ComponentRef Id="WixBindingFiles"/>
				<ComponentRef Id="WixUIMondoProjectTemplate"/>
				<ComponentRef Id="WixUIMinimalProjectTemplate"/>
				<ComponentRef Id="WixUIInstallDirProjectTemplate"/>
				<ComponentRef Id="WixUIFeatureTreeProjectTemplate"/>
				<ComponentRef Id="FormsDesignerFiles"/>
				<ComponentRef Id="IconEditorFiles"/>
				<ComponentRef Id="ResourceEditorFiles"/>
				<ComponentRef Id="SettingsEditorFiles"/>
				<ComponentRef Id="ClassDiagramResources"/>
				<ComponentRef Id="ClassDiagramAddInFiles"/>
				<ComponentRef Id="ClassCanvasDll"/>
				<ComponentRef Id="DiagramsDll"/>
				
				<ComponentRef Id="ICSharpCodeXamlBindingDll"/>
				<ComponentRef Id="XamlBindingAddin"/>
				
				<!--<ComponentRef Id="WorkflowDesignerAddin"/>
				<ComponentRef Id="WorkflowDesignerDll"/>-->
				
				<ComponentRef Id="XmlEditorFiles"/>
				<ComponentRef Id="AddInManagerFiles"/>
				<ComponentRef Id="AddInManagerSharpZipLibDll"/>
				<ComponentRef Id="AddInScoutFiles"/>
				<ComponentRef Id="CodeAnalysisFiles"/>
				<ComponentRef Id="CodeQualityFiles"/>
				<ComponentRef Id="CodeCoverageFiles"/>
				<ComponentRef Id="DebuggerAddInFiles"/>
				<ComponentRef Id="FiletypeIcons"/>
				<ComponentRef Id="FiletypeRegistererFiles"/>
				<ComponentRef Id="HtmlHelp2Files"/>
				<ComponentRef Id="PInvokeAddInFiles"/>
				<ComponentRef Id="RegExToolkitFiles"/>
				<ComponentRef Id="ResourceToolkitFiles"/>
				<ComponentRef Id="SearchAndReplaceFiles"/>
				<ComponentRef Id="ILSpyAddInFiles"/>

				<ComponentRef Id="StartPageAddInFiles"/>
				<ComponentRef Id="SubversionAddInDll"/>
				<ComponentRef Id="GitAddInDll"/>
				<ComponentRef Id="UnitTestingAddInFiles"/>
				<ComponentRef Id="SyntaxModesFiles"/>
				<ComponentRef Id="SharpDevelopWebsiteShortcut"/>
				<ComponentRef Id="SharpDevelopAppPathRegistrySetting"/>
				<ComponentRef Id="WPFAssemblyInfoTemplate"/>
				<ComponentRef Id="AddInWritingHelp"/>
				<ComponentRef Id="CSharpProjectSharpDevelopCustomToolTemplates"/>
				<ComponentRef Id="AddInWritingHelpWebsiteShortcut"/>
				<ComponentRef Id="AppConfigFileTemplate"/>
				
				<ComponentRef Id="ICSharpCodeScriptingDll"/>
				<ComponentRef Id="PythonConsoleProjectTemplate"/>
				<ComponentRef Id="PythonEmptyClassTemplate"/>
				<ComponentRef Id="PythonEmptyFormTemplate"/>
				<ComponentRef Id="PythonEmptyUserControlTemplate"/>
				<ComponentRef Id="PythonEmptyFileTemplate"/>
				<ComponentRef Id="PythonFormsProjectTemplate"/>
				<ComponentRef Id="PythonLibraryProjectTemplate"/>
				<ComponentRef Id="PythonSilverlightApplicationProjectTemplate"/>
				<ComponentRef Id="PythonWPFApplicationProjectTemplate"/>
				<ComponentRef Id="PythonWPFWindowFileTemplate"/>
				<ComponentRef Id="IpyExe"/>
				<ComponentRef Id="IronPythonModulesDll"/>
				<ComponentRef Id="IronPythonDll"/>
				<ComponentRef Id="IronPythonWpfDll"/>
				<ComponentRef Id="IronPythonLicenseRtf"/>
				<ComponentRef Id="PythonChironExe"/>
				<ComponentRef Id="PythonChironExeConfig"/>
				<ComponentRef Id="MicrosoftDynamicDll"/>
				<ComponentRef Id="MicrosoftScriptingDll"/>
				<ComponentRef Id="MicrosoftScriptingMetadataDll"/>
				<ComponentRef Id="PythonBuildTasksDll"/>
				<ComponentRef Id="PythonBindingAddin"/>
				<ComponentRef Id="PythonBindingDll"/>
				<ComponentRef Id="PythonBindingLibRunpyPy"/>
				<ComponentRef Id="PythonBindingLibSitePy"/>
				<ComponentRef Id="PythonBindingLibFuturePy"/>
				<ComponentRef Id="SharpDevelopBuildPythonTargets"/>
				<ComponentRef Id="PythonBindingSdTestPy"/>
				<ComponentRef Id="PythonBindingSdTestRunnerPy"/>
				
				<ComponentRef Id="IrExe"/>
				<ComponentRef Id="IronRubyDll"/>
				<ComponentRef Id="IronRubyLibrariesDll"/>
				<ComponentRef Id="IronRubyLicenseApacheHtml"/>
				<ComponentRef Id="RubyBindingAddin"/>
				<ComponentRef Id="RubyBindingDll"/>
				<ComponentRef Id="RubyChironExe"/>
				<ComponentRef Id="RubyChironExeConfig"/>
				<ComponentRef Id="RubyMicrosoftDynamicDll"/>
				<ComponentRef Id="RubyMicrosoftScriptingDll"/>
				<ComponentRef Id="RubyMicrosoftScriptingMetadataDll"/>
				<ComponentRef Id="RubyEmptyClassFileTemplate"/>
				<ComponentRef Id="RubyConsoleProjectTemplate"/>
				<ComponentRef Id="RubyEmptyFormFileTemplate"/>
				<ComponentRef Id="RubyEmptyFileTemplate"/>
				<ComponentRef Id="RubyEmptyUserControlFileTemplate"/>
				<ComponentRef Id="RubyFormsProjectTemplate"/>
				<ComponentRef Id="RubyLibraryProjectTemplate"/>
				<ComponentRef Id="RubySilverlightApplicationProjectTemplate"/>
				<ComponentRef Id="RubyWPFApplicationProjectTemplate"/>
				<ComponentRef Id="RubyWPFWindowFileTemplate"/>
				<ComponentRef Id="RubyBindingSdSelectedTestsFileRb"/>
				<ComponentRef Id="RubyBindingSdTestRb"/>
				<ComponentRef Id="RubyBindingSdTestResultRb"/>
				<ComponentRef Id="RubyBindingSdTestResultWriterRb"/>
				<ComponentRef Id="RubyBindingSdTestRunnerRb"/>
				
				<ComponentRef Id="FSharpBindingDll"/>
				<ComponentRef Id="FSharpBindingAddin"/>	
				<ComponentRef Id="FSharpConsoleProjectTemplate"/>	
				<ComponentRef Id="FSharpEmptyClassTemplate"/>
				
				<ComponentRef Id="SharpDevelopSourceAnalysisTargets"/>
				<ComponentRef Id="SourceAnalysisAddin"/>
				<ComponentRef Id="SourceAnalysisDll"/>
				<ComponentRef Id="SharpRefactoringAddin"/>
				<ComponentRef Id="SharpRefactoringDll"/>
			
				<ComponentRef Id="HexEditorAddin"/>
				<ComponentRef Id="HexEditorDll"/>
				
				<ComponentRef Id="AvalonEditAddInAddin"/>
				<ComponentRef Id="ICSharpCodeAvalonEditAddInDll"/>
				
				<ComponentRef Id="Hook32Dll"/>
				<ComponentRef Id="Hook64Dll"/>
				<ComponentRef Id="ICSharpCodeProfilerAddInAddin"/>
				<ComponentRef Id="ICSharpCodeProfilerAddInDll"/>
				<ComponentRef Id="ICSharpCodeProfilerControllerDll"/>
				<ComponentRef Id="ICSharpCodeProfilerControlsDll"/>
				<ComponentRef Id="SystemDataSQLiteDll"/>
				<ComponentRef Id="IQToolkitDll"/>
				
				<ComponentRef Id="CppBindingAddin"/>
				<ComponentRef Id="CppBindingDll"/>
				<ComponentRef Id="CppBindingTemplates"/>
				
				<ComponentRef Id="ICSharpCodeWpfDesignAddInDll"/>
				<ComponentRef Id="ICSharpCodeWpfDesignDesignerDll"/>
				<ComponentRef Id="ICSharpCodeWpfDesignDll"/>
				<ComponentRef Id="ICSharpCodeWpfDesignXamlDomDll"/>
				<ComponentRef Id="WpfDesignAddin"/>
				
				<ComponentRef Id="ICSharpCodeDataAddin"/>
				<ComponentRef Id="ICSharpCodeDataAddinDll"/>
				<ComponentRef Id="ICSharpCodeDataCoreDll"/>
				<ComponentRef Id="ICSharpCodeDataCoreUIDll"/>
				<ComponentRef Id="ICSharpCodeDataEDMDesignerCoreDll"/>
				<ComponentRef Id="ICSharpCodeDataEDMDesignerCoreUIDll"/>
				<ComponentRef Id="ICSharpCodeDataSQLServerDll"/>
				<ComponentRef Id="CSharpEDMXXft"/>
				
				<ComponentRef Id="UDCSystemDataSQLiteDll"/>
				<ComponentRef Id="UsageDataCollectorAddin"/>
				<ComponentRef Id="UsageDataCollectorDll"/>
				
				<ComponentRef Id="SharpDevelopReportsEmptyReportFileTemplate"/>
				<ComponentRef Id="ICSharpCodeReportDesignerAddin"/>
				<ComponentRef Id="ICSharpCodeReportsAddinDll"/>
				<ComponentRef Id="ICSharpCodeReportsCoreDll"/>
				<ComponentRef Id="IronyDll"/>
				<ComponentRef Id="ITextSharpDll"/>
			
				<ComponentRef Id="AboutNuGetCmdletsHelpTxt"/>
				<ComponentRef Id="NuGetConsoleTypesDll"/>
				<ComponentRef Id="NuGetCoreDll"/>
				<ComponentRef Id="NuGetNuspecSchema"/>
				<ComponentRef Id="NuGetLicenseTxt"/>
				<ComponentRef Id="PackageFormatPs1Xml"/>
				<ComponentRef Id="PackageManagementAddin"/>
				<ComponentRef Id="PackageManagementCmdletsDll"/>
				<ComponentRef Id="PackageManagementCmdletsDllHelpXml"/>
				<ComponentRef Id="PackageManagementDll"/>
				<ComponentRef Id="SharpDevelopEnvDteDll"/>
				<ComponentRef Id="PackageManagementPowerShellDll"/>
				<ComponentRef Id="PackageManagementICSharpCodeSharpDevelopDomDll"/>
				<ComponentRef Id="JQuery172NuGetPackage"/>
				<ComponentRef Id="Modernizr253NuGetPackage"/>
			
				<ComponentRef Id="MonoTextTemplatingDll"/>
				<ComponentRef Id="TextTemplatingAddin"/>
				<ComponentRef Id="TextTemplatingDll"/>
				<ComponentRef Id="CSharpTextTemplateFileTemplate"/>
				<ComponentRef Id="VBTextTemplateFileTemplate"/>
			
				<ComponentRef Id="MachineSpecificationsAddIn"/>
				<ComponentRef Id="MachineSpecificationsCommandLineDll"/>
				<ComponentRef Id="MachineSpecificationsDll"/>
				<ComponentRef Id="MachineSpecificationsLicenseTxt"/>
				<ComponentRef Id="ToolsMachineSpecificationsDll"/>
				<ComponentRef Id="MachineSpecificationsReportingDll"/>
				<ComponentRef Id="MachineSpecificationsSparkDll"/>
				<ComponentRef Id="Mspec_clr4Exe"/>
				<ComponentRef Id="Mspec_x86_clr4Exe"/>
				<ComponentRef Id="Mspec_x86Exe"/>
				<ComponentRef Id="MspecExe"/>
				
				<ComponentRef Id="AspNetMvcAddin"/>
				<ComponentRef Id="AspNetMvcDll"/>
				<ComponentRef Id="AspNetMvcMonoTextTemplatingDll"/>
				<ComponentRef Id="SystemWebRazorDll"/>
				<ComponentRef Id="AspNetMvcTextTemplatingDll"/>
				<ComponentRef Id="AspNetMvcCSharpControllerTemplate"/>
				<ComponentRef Id="AspNetMvcAspxCSharpCreateTemplate"/>
				<ComponentRef Id="AspNetMvcAspxCSharpDeleteTemplate"/>
				<ComponentRef Id="AspNetMvcAspxCSharpDetailsTemplate"/>
				<ComponentRef Id="AspNetMvcAspxCSharpEditTemplate"/>
				<ComponentRef Id="AspNetMvcAspxCSharpEmptyTemplate"/>
				<ComponentRef Id="AspNetMvcAspxCSharpListTemplate"/>
				<ComponentRef Id="AspNetMvcRazorCSharpCreateTemplate"/>
				<ComponentRef Id="AspNetMvcRazorCSharpDeleteTemplate"/>
				<ComponentRef Id="AspNetMvcRazorCSharpDetailsTemplate"/>
				<ComponentRef Id="AspNetMvcRazorCSharpEditTemplate"/>
				<ComponentRef Id="AspNetMvcRazorCSharpEmptyTemplate"/>
				<ComponentRef Id="AspNetMvcRazorCSharpListTemplate"/>
				<ComponentRef Id="AspNetMvcVisualBasicControllerTemplate"/>
				<ComponentRef Id="AspNetMvcAspxVisualBasicCreateTemplate"/>
				<ComponentRef Id="AspNetMvcAspxVisualBasicDeleteTemplate"/>
				<ComponentRef Id="AspNetMvcAspxVisualBasicDetailsTemplate"/>
				<ComponentRef Id="AspNetMvcAspxVisualBasicEditTemplate"/>
				<ComponentRef Id="AspNetMvcAspxVisualBasicEmptyTemplate"/>
				<ComponentRef Id="AspNetMvcAspxVisualBasicListTemplate"/>
				<ComponentRef Id="AspNetMvcRazorVisualBasicCreateTemplate"/>
				<ComponentRef Id="AspNetMvcRazorVisualBasicDeleteTemplate"/>
				<ComponentRef Id="AspNetMvcRazorVisualBasicDetailsTemplate"/>
				<ComponentRef Id="AspNetMvcRazorVisualBasicEditTemplate"/>
				<ComponentRef Id="AspNetMvcRazorVisualBasicEmptyTemplate"/>
				<ComponentRef Id="AspNetMvcRazorVisualBasicListTemplate"/>
				<ComponentRef Id="CSharpMvcRazorLayoutPageFileTemplate"/>
				<ComponentRef Id="CSharpMvcRazorPartialPageFileTemplate"/>
				<ComponentRef Id="CSharpMvcRazorViewPageFileTemplate"/>
				<ComponentRef Id="VBMvcRazorLayoutPageFileTemplate"/>
				<ComponentRef Id="VBMvcRazorPartialPageFileTemplate"/>
				<ComponentRef Id="VBMvcRazorViewPageFileTemplate"/>
				<ComponentRef Id="CSharpMvcRazorProjectTemplate"/>
				<ComponentRef Id="VBMvcRazorProjectTemplate"/>

				<ComponentRef Id="JavaScriptBindingDll"/>
				<ComponentRef Id="JavaScriptBindingAddin"/>
				<ComponentRef Id="Antlr3RuntimeDll"/>
			
				<ComponentRef Id="OpenCoverConsoleExe"/>
				<ComponentRef Id="OpenCoverConsoleExeConfig"/>
				<ComponentRef Id="OpenCoverFrameworkDll"/>
				<ComponentRef Id="OpenCoverGendarmeRulesMaintainabilityDll"/>
				<ComponentRef Id="OpenCoverGendarmeFrameworkDll"/>
				<ComponentRef Id="OpenCoverLog4netConfig"/>
				<ComponentRef Id="OpenCoverLog4netDll"/>
				<ComponentRef Id="OpenCoverMicrosoftPracticesUnityDll"/>
				<ComponentRef Id="OpenCoverMonoCecilDll"/>
				<ComponentRef Id="OpenCoverMonoCecilPdbDll"/>
				<ComponentRef Id="OpenCoverProfilerX86Dll"/>
				<ComponentRef Id="OpenCoverProfilerX64Dll"/>
			</Feature>
			<Feature Id="SharpDevelopFileAssociations"
			         Level="2"
			         AllowAdvertise="no"
				     InstallDefault="local"
			         Title="File Associations"
			         Description="Registers file associations with SharpDevelop.">
				<!-- 
					We put a reference to a dummy component which contains no files
					so we can get rid of the Network install options from the drop
					down menu for this feature. Seems to be a bug in Windows Installer.
				-->
				<ComponentRef Id="DummyFileAssocationFeatureComponent"/>
				<Feature Id="BooProjectFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="Boo Projects (.booproj)"
				         Description="Associates Boo projects (.booproj) with SharpDevelop">
					<ComponentRef Id="BooProjectFileAssociation"/>
				</Feature>
				<Feature Id="CSharpFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="C# Files (.cs)"
				         Description="Associates C# Files (.cs) with SharpDevelop">
					<ComponentRef Id="CSharpFileAssociation"/>
				</Feature>
				<Feature Id="CSharpProjectFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="C# Projects (.csproj)"
				         Description="Associates C# Projects (.csproj) with SharpDevelop">
					<ComponentRef Id="SharpDevelopCSharpProjectFileAssociation"/>
				</Feature>
				<Feature Id="PythonProjectFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="Python Project Files (.pyproj)"
				         Description="Associates Python Projects (.pyproj) with SharpDevelop">
					<ComponentRef Id="PythonProjectFileAssociation"/>
				</Feature>
				<Feature Id="ResxFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="Resource Files (.resx)"
				         Description="Associates Resource Files (.resx) with SharpDevelop">
					<ComponentRef Id="ResxFileAssociation"/>
				</Feature>
				<Feature Id="ResourcesFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="Binary Resource Files (.resources)"
				         Description="Associates Binary Resources files (.resources) with SharpDevelop">
					<ComponentRef Id="ResourcesFileAssociation"/>
				</Feature>
				<Feature Id="AddInFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="SharpDevelop AddIn Installation Packages (.sdaddin)"
				         Description="Associates SharpDevelop AddIn Installation packages (.sdaddin) with SharpDevelop">
					<ComponentRef Id="SharpDevelopAddInFileAssociation"/>
				</Feature>
				<Feature Id="SolutionFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="SharpDevelop Solutions (.sln)"
				         Description="Associates SharpDevelop Solutions (.sln) with SharpDevelop">
					<ComponentRef Id="SharpDevelopSolutionFileAssociation"/>
				</Feature>
				<Feature Id="VBFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="VB.NET Files (.vb)"
				         Description="Associates VB.NET Files (.vb) with SharpDevelop">
					<ComponentRef Id="VBFileAssociation"/>
				</Feature>
				<Feature Id="VBProjectFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="VB.NET Projects (.vbproj)"
				         Description="Associates VB.NET Projects (.vbproj) with SharpDevelop">
					<ComponentRef Id="SharpDevelopVBProjectFileAssociation"/>
				</Feature>
				<Feature Id="WixProjectFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="SharpDevelop WiX Projects (.wixproj)"
				         Description="Associates SharpDevelop WiX Projects (.wixproj) with SharpDevelop">
					<ComponentRef Id="SharpDevelopWixProjectFileAssociation"/>
				</Feature>
				<Feature Id="XmlFileAssociation"
				         Level="2"
				         AllowAdvertise="no"
				         InstallDefault="local"
				         Title="XML Files (.xml)"
				         Description="Associates XML Files (.xml) with SharpDevelop">
					<ComponentRef Id="XmlFileAssociation"/>
				</Feature>
			</Feature>
		</Feature>
		
		<!-- Using WixUI -->
		<Property Id="WIXUI_INSTALLDIR">INSTALLDIR</Property>
		<UIRef Id="WixUI_FeatureTree"/>
		
		<!--
			If a newer version of SharpDevelop is installed, show an error message.
	
			This message is not displayed immediately, the FindRelatedProducts 
			action occurs well into the installation after the user has
			configured everything.
		-->
		<CustomAction Id="NoDowngrade" Error="A later version of [ProductName] is already installed." />
		
		<!-- Add RemoveExistingProducts action to install sequence so upgrades can work -->
		<InstallExecuteSequence>
			<!--
				Display an error message if a newer version found.
				
				Since the installer completely removes the existing SharpDevelop installation,
				downgrades would work without any problems, but for now we 
				inform the user that a newer version already exists.
				-> Actually, there's trouble with downgrades because Windows Installer first determines
					the existing components before removing the old installation; so all versioned
					libraries will get removed instead of downgraded.
 			-->
			<Custom Action="NoDowngrade" After="FindRelatedProducts">NEWERVERSIONFOUND</Custom>
			<!--
				Removes the older version of SharpDevelop, if we are upgrading,
				before installing the new version.

				Unfortunately the user is not informed of this upgrade. I think
				we need a custom dialog showing the old installation located and
				the fact that it is going to be upgraded.

				The best place to do this is after InstallFinalize however if we
				do it then after we have removed a file from an addin, and changed
				the Component Guid, the modified component is not installed. So
				we make sure SharpDevelop is completely removed before installing
				the newer version. This also covers us if we accidentally
				modify a component but do not change its Guid.

				http://msdn.microsoft.com/library/en-us/msi/setup/removeexistingproducts_action.asp
			-->
			<RemoveExistingProducts Before="InstallInitialize"/>
		</InstallExecuteSequence>
	</Product>
</Wix>
